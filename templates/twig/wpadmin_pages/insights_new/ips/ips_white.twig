{% block section_table %}
	<div class="row insights_widget" id="SectionTableIpsWhite">
		{% block section_form_addip %}
			<div class="col-12">
				<form class="form-inline" id="NewIp" action="#" method="post">
					{% for name,val in ajax.add_ip_white %}
						<input type="hidden" name="{{ name }}" value="{{ val }}" />
					{% endfor %}
					<label class="sr-only" for="IpAddress">IpAddress</label>
					<div class="input-group w-100">
						<div class="input-group-prepend">
							<div class="input-group-text" style="border-radius: 0">New IP:</div>
						</div>
						<input type="text" class="form-control" id="IpAddress" name="ip"
							   placeholder="enter IP to whitelist" />
						<input type="text" class="form-control" id="Label" name="label"
							   placeholder="label for IP" />
						<div class="input-group-append">
							<button type="submit" class="btn btn-info add" style="border-radius: 0;" name="subbutt"
									title="Add IP"><span class="dashicons dashicons-plus"></span></button>
						</div>
					</div>
				</form>
			</div>
		{% endblock %}
		<div class="col-12" id="TableIpsWhite"></div>
	</div>
{% endblock %}

{% block section_table_js %}
	<script>
		var iCWP_WPSF_WhiteIps = new function () {

			var $oTable;

			var submitForm = function ( event ) {
				iCWP_WPSF_BodyOverlay.show();
				event.preventDefault();

				jQuery.post( ajaxurl, jQuery( this ).serialize(),
					function ( oResponse ) {
						if ( oResponse.success ) {
							$oTable.reloadTable();
							iCWP_WPSF_Growl.showMessage( oResponse.data.message, oResponse.success );
						}
						else {
							var sMessage = 'Communications error with site.';
							if ( oResponse.data.message !== undefined ) {
								sMessage = oResponse.data.message;
							}
							alert( sMessage );
							iCWP_WPSF_BodyOverlay.hide();
						}
					}
				).always( function () {
					}
				);
			};

			var deleteEntry = function ( event ) {
				iCWP_WPSF_BodyOverlay.show();
				event.preventDefault();

				var requestData = {{ ajax.ip_delete|raw }};
				requestData[ 'id' ] = jQuery( this ).data( 'id' );

				jQuery.post( ajaxurl, requestData,
					function ( oResponse ) {
						if ( oResponse.success ) {
							$oTable.reloadTable();
							iCWP_WPSF_Growl.showMessage( oResponse.data.message, oResponse.success );
						}
						else {
							var sMessage = 'Communications error with site.';
							if ( oResponse.data.message !== undefined ) {
								sMessage = oResponse.data.message;
							}
							alert( sMessage );
							iCWP_WPSF_BodyOverlay.hide();
						}
					}
				).always( function () {
					}
				);
			};

			this.initialise = function () {
				$oTable = jQuery( '#TableIpsWhite' ).icwpWpsfAjaxTable(
					{
						'ajax_render':{{ ajax.render_table_ip|raw }},
						'req_params': {
							'fList': 'MW'
						}
					}
				);
				jQuery( '#SectionTableIpsWhite' ).on( "submit", "form#NewIp", submitForm );
			};
		}();

		iCWP_WPSF_WhiteIps.initialise();
	</script>
{% endblock %}